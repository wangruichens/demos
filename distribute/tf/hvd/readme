1.下载安装Openmpi

https://www.open-mpi.org/faq/?category=building#easy-build

gunzip -c openmpi-4.0.1.tar.gz | tar xf -
cd openmpi-4.0.1
./configure --prefix=/usr/local
make -j8  (8线程，速度快一些)
sudo make install

*(
完成后需要添加环境变量到.bashrc：
export PATH="$PATH:/usr/local/openmpi/bin"
export LD_LIBRARY_PATH="$LD_LIBRARY_PATH:/usr/local/openmpi/lib/"
完成后执行
sudo ldconfig
)

测试是否安装成功：
mpirun   或 which mpirun
或者编译运行测试脚本：
cd examples
make
mpirun -np 8 hello_c


pip安装 horovod
pip install -i  https://pypi.tuna.tsinghua.edu.cn/simple horovod

然而我遇到一个错误：
mpi_lib.cpython-36m-x86_64-linux-gnu.so: undefined symbol:_ZN10tensorflow12OpDefBuilder4AttrESs
解决办法：
https://github.com/horovod/horovod/issues/656

原因是因为conda和系统自带的gcc版本不同

$ pip uninstall -y horovod
$ conda install gcc_linux-64 gxx_linux-64
CC=/opt/anaconda3/bin/x86_64-conda_cos6-linux-gnu-gcc
需要手动指定gcc 位置，重新安装hvd：
CC=/opt/anaconda3/bin/x86_64-conda_cos6-linux-gnu-gcc pip install --no-cache-dir -i  https://pypi.tuna.tsinghua.edu.cn/simple horovod
$ [flags] pip install --no-cache-dir -i  https://pypi.tuna.tsinghua.edu.cn/simple horovod

测试代码：
def fn(magic_number):
    import horovod.torch as hvd
    hvd.init()
    print('Hello, rank = %d, local_rank = %d, size = %d, local_size = %d, magic_number = %d' % (hvd.rank(), hvd.local_rank(), hvd.size(), hvd.local_size(), magic_number))
    return hvd.rank()
import horovod.spark
horovod.spark.run(fn, args=(42,))